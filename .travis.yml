# Template used from https://github.com/jonstites/hello-cicd
rust: stable
language: rust

script:
  - cargo build 

matrix:
  include:
    - os: linux
      env: TARGET=i686-unknown-linux-musl
    - os: linux
      env: TARGET=x86_64-unknown-linux-musl
    - os: osx
      env: TARGET=x86_64-apple-darwin
    - os: windows
      env: TARGET=x86_64-pc-windows-msvc
    - os: windows
      env: TARGET=i686-pc-windows-msvc

install:
  - rustup target add $TARGET
      
before_deploy:
  - |
    (
    cargo build --release --target $TARGET    
    if [ "$TRAVIS_OS_NAME" = 'windows' ]; then
      cp target/${TARGET}/release/krakenxtract.exe krakenxtract-${TRAVIS_TAG}-${TARGET}.exe
    else
      cp target/${TARGET}/release/krakenxtract krakenxtract-${TRAVIS_TAG}-${TARGET}
    fi
    )
    
deploy:
  api_key:
    secure: "SMZPjKTBOKbo9luGtvkuWJFoc5YqMC2DiCtiHnHGJZiePkO/RZkybltTnM0q1TJLMMEdpzi2KNetQCAzACzRZXwyh8xMvB/4+JljdeyURVjA9joWPdduyRYLMy+CXeCkUcVflGJEdZKvmxjy6cgbMt1b7iNSJ+QEuBIzBr5t4GPIU7AROvRtQg6CP26RE/EXMq64vlNuOKfnuef397eUe6biXYxUWhzCI7IHCP3UvIgxQq4QPdOq6AJWD4bEmv4L5yxvHbpjGu9PRVAsoBo4EtgThb8ievAtJvBA4jh/Xk00+UaKAxakRsAR5TtTlga/pm+r+/bmu5wYNOpwD+OtevszaVNdx0cFDnRU9RPhPEXsmIrox6mo+Xe1OPX9jt8K5zJXF59/k1ZulcLUQZkOx23dfl6RXel2slUnrLE4K2l4Vx6J10qkdBC3DG7VYMqWFC8m9yNbCLcd/xKuP7be8ZF+X43jhqRdfRNmUJWZjc2KPTBQSLAK1X+wtdh0Kf21JpOV5EavFya8LwQRuDYYRpTubkwvL2QYvw7OTzwSt6qhYGxjqAFIHnW2qlAaC2HO7js58Q+fW4UZvEialU/bPmdeXsU1v8PawB/LmrtwQquAiab+EwrUbcYHEQQMms82fEImgYnos+ZqtGLfJ7twhWwdKAdsBBpAUSH8o/isDz0="

  file: krakenxtract-${TRAVIS_TAG}-${TARGET}*
  file_glob: true

  on:
    tags: true

  provider: releases
  skip_cleanup: true
  
branches:
  only:
    # Pushes and PR to the master branch
    - main
    # Ruby regex to match tags.
    # Required, or travis won't trigger deploys when a new tag is pushed.
    - /^v\d+\.\d+(\.\d+)?(-\S*)?$/
    
notifications:
  email:
    on_success: never